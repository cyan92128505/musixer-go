package utils_test

import (
	"musixer/api/internal/app/utils"
	"testing"
	"time"

	"github.com/stretchr/testify/assert"
)

func TestTokenCreationAndValidation(t *testing.T) {
	privateKey := "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBeTdzZzVzUDdjRTNkbVBkbCtXTmZOR1duM21BQ3ZUWGtDUEFVbzR6REw0R1BlVFF2CmRKVUtmY3lVQlVYWW96U1AvR0tnRjBVcHdxTFdWZG5HbmRKWWxHbzN2M2MxdmkrZDdnRUJoOU1mUHcxZXZjOVAKVnRkRlRCeTc0Rzh6ckFIQmM3aHNUSWxvVHJwenVoZmFEMXZZNWloSmtOYVJNN1FSZU5WUldoblNNQkxRNDRsbQpKbkxEQ1pUSy9zQUErM2RpenZGOFQwd0ttQlRoT0dzY2xGa1JneE02MEpmYWdOKzRlc1ZiSmNNakRPVnp5di81CnVJNjhDY0ZPZU9RQ05TVm1sQjZSTDFmakdEaGxoY3JuZEFsK2l3WERoY0xMUWh0Skg2b1UyVnRqcW9seThhWmMKdTdLUExqakFGOEhuUVJvZnBkeEI0d2x3RDQ0LzNUN05DS1ZmU1FJREFRQUJBb0lCQVFDY3dORnkzUTVFZlpUbwpFa3FpMVFPMnRCU3lkQnNIYkVTVlgrdnhYdWY3VUd1TTdVc3FIMWJnTGgwaDVYam5NaFVyTXROTXRFbUtXWElpCndob2c2bXgvWFM2aG9kNTNBL28yMncxTGJYVFlOYmhVd1FLaHBhYkxCanpFVmF0alNFS0pnRGZMdDluSzRZa1QKZ1RDbHFweTdrZm53ZURkbW1jRHJ3TzRFTG1QYjJlNjdzYnpEbGw0aGtmTi93RlhGbzg0MzhYYkxaajNNMjFPWApvSmN3aHN0OEVNa2o0TEl1T0k1eWlzWm9XQnoyR1FFRTBEM0UrQ050bW1INjM1bkxZMjVkTnVHTWFSVTVFS0svCmNBSy9wTVR1VXVWSnZVTGpsR2pkVTRUZ05Hc040OU9oOVhHZWdWOTdyNnFxeHdHUW4xY29RdDdiMjF4ckVKL3oKUTZHS0pqYVJBb0dCQU94MjE3Zk9vWkpRZ3AyT0NQcDFRS3BLU1NsbjJuZkdzVFVXR3BWRThhYkZpckU1NWRsUwoyVkdrSHNHRXhadHFrUWRsek5GWGg0KzFBT21JSmFIeEpIM2R1YzJZVnZBSytzekRPWVNpeFZiQkg2Mmp3b3ErCjZKbDN6ZC9FK09kSmcxM2hKMjhTNnlObVBWZWRBb0FNZG5rUk9CMjZwMGhJMnA0NHNONWM1cFI5QW9HQkFOeVAKL0dVSUhzRjlVamk0K1h2Y1NKOVpOTlpKMm1KTmxyUGNlZjM1emFlSlM5cFZJUEdOdlhsNFVtUUZseXM4QXQwQQpMZTVDR2ErNG5vRGQ2U0tLbUpEY0JGSURwU0JZdXAxeUVoYVVoMzh6aXpPbEtFSnF5Q3Z4ZmltdHJia3haMDVyCkxaV05CaDdCUlF2R0pVU3g4a3daRjBTdWNRZDF1eGdrWEhCcWQrdTlBb0dBTm9FR0pBWHExQkRlcW5aTXQzNUQKVTMwZjgvMU9MQUdPWXhBZlBIelJ2b0VXQU5lNWxTZzFrMDNqRVBRTG9GRWw4TENVVDBSL3FLNHQ4YVpDRmx2QQo3NG9tQTYremlremRsa2tCZndNTnZYdHlVOUhGUzduSlgyWnYrNzRwS1JhV3d4TGN4Z3QwUzRxTFpTQjVyUTR5CldLR1JiN2pRU2ljUXpSdUFHU0VNdlBrQ2dZQjJWR2s4YXRiVlI3N00zN0E1V3owN0FFandqajZ6YnB6amNlMmcKN0Z3QS9nL0wydEFKeDlsWFNjNHFDelhHNURORkRjdVdmNi80TGp3Yk52TFVyVGFjd08wd2N2UXNIbTQvK2VycQpZbFV2VVIvbFhUMzBKQVd3VGFjNkJRdW14M0o5QjlNMDRLdmY1Q0IrNkpjbCs3SGFVYnZDQlRSdXBDTDBHTTNmCkliK2tvUUtCZ0JyL3VsZEZMM0tYRlpZS0lzMXhuT24xWmRkZmpmaTRoMTNua3B4MVJpenpTV3VSQnRPcGU0L2IKbEFZbHljSHl2Uk9HVmNZOTczdkVXMDlINlJSSi9Ya2s1SlBHMnMrR0ZyckhoYjlrY0tTNnpYdVpvQTFxVFlDTgpYM2laQm5WalhxUlhINHVvd3ppTkVSYzZITTMxSmcxRzZMM1pRcmdwZ1haK1J1dHpKQlpCCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg=="

	publicKey := "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBeTdzZzVzUDdjRTNkbVBkbCtXTmYKTkdXbjNtQUN2VFhrQ1BBVW80ekRMNEdQZVRRdmRKVUtmY3lVQlVYWW96U1AvR0tnRjBVcHdxTFdWZG5HbmRKWQpsR28zdjNjMXZpK2Q3Z0VCaDlNZlB3MWV2YzlQVnRkRlRCeTc0Rzh6ckFIQmM3aHNUSWxvVHJwenVoZmFEMXZZCjVpaEprTmFSTTdRUmVOVlJXaG5TTUJMUTQ0bG1KbkxEQ1pUSy9zQUErM2RpenZGOFQwd0ttQlRoT0dzY2xGa1IKZ3hNNjBKZmFnTis0ZXNWYkpjTWpET1Z6eXYvNXVJNjhDY0ZPZU9RQ05TVm1sQjZSTDFmakdEaGxoY3JuZEFsKwppd1hEaGNMTFFodEpINm9VMlZ0anFvbHk4YVpjdTdLUExqakFGOEhuUVJvZnBkeEI0d2x3RDQ0LzNUN05DS1ZmClNRSURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K"

	userID := "user123"
	tokenTTL := time.Hour

	token, err := utils.CreateToken(userID, tokenTTL, privateKey)
	assert.NoError(t, err)
	assert.NotNil(t, token)
	assert.NotNil(t, token.Token)
	assert.NotEmpty(t, token.TokenUuid)
	assert.NotEmpty(t, token.UserID)
	assert.NotNil(t, token.ExpiresIn)

	validatedToken, err := utils.ValidateToken(*token.Token, publicKey)
	assert.NoError(t, err)
	assert.NotNil(t, validatedToken)
	assert.Equal(t, token.TokenUuid, validatedToken.TokenUuid)
	assert.Equal(t, token.UserID, validatedToken.UserID)
}
